# Data Model — Phase 0 CAD Foundations

## Overview

Phase 0 introduces configuration and metadata files rather than persistent databases. The data model captures structured artifacts that underpin automation and validation.

## Entities

### EnvironmentProfile
- **Description**: Captures workstation capability and dependency versions detected by the CLI.
- **Fields**:
  - `os_name` (enum: `macOS`, `Ubuntu`)
  - `os_version` (string, semantic)
  - `python_version` (string, must be `>=3.12.0`)
  - `uv_active` (boolean)
  - `packages` (list of PackageRecord)
  - `verification_timestamp` (ISO 8601)
- **Relationships**: Contains many `PackageRecord` entries.
- **Validation Rules**: `python_version` must satisfy semantic comparison ≥3.12; `packages` must include Build123d and CadQuery entries.

### PackageRecord
- **Description**: Represents a dependency and its resolved version.
- **Fields**:
  - `name` (string, enum subset enforced via code)
  - `version` (string, semantic)
  - `status` (enum: `installed`, `missing`, `mismatch`)
- **Relationships**: Belongs to exactly one `EnvironmentProfile`.
- **Validation Rules**: `status` must be `installed`; `version` must match lock file tolerance (same major and minor as pinned).

### RepositorySkeleton
- **Description**: Defines required files/directories for scaffold validation.
- **Fields**:
  - `path` (string, normalized POSIX path)
  - `type` (`directory` or `file`)
  - `required` (boolean)
  - `description` (string)
- **Relationships**: Aggregated into `ScaffoldReport`.
- **Validation Rules**: All entries marked required must exist; CLI emits violations for missing nodes.

### ScaffoldReport
- **Description**: Outcome of running scaffold validation.
- **Fields**:
  - `checked_at` (ISO 8601)
  - `items` (list of ScaffoldResult)
  - `status` (enum: `pass`, `fail`)
- **Relationships**: Contains many `ScaffoldResult` objects.
- **Validation Rules**: `status` is `pass` only if every `ScaffoldResult.state` == `present`.

### ScaffoldResult
- **Description**: Evaluation of a single repository path.
- **Fields**:
  - `path` (string)
  - `state` (enum: `present`, `missing`, `unexpected`)
  - `notes` (string, optional)
- **Relationships**: Belongs to a `ScaffoldReport`.
- **Validation Rules**: `state` must be drawn from enum.

### UtilitySpec
- **Description**: Metadata describing each shared utility module for documentation automation.
- **Fields**:
  - `name` (string)
  - `purpose` (string)
  - `inputs` (list of strings)
  - `outputs` (list of strings)
  - `cli_command` (string, optional)
- **Relationships**: Referenced in quickstart documentation.
- **Validation Rules**: `name` must be unique; `inputs`/`outputs` lists cannot be empty.

### ToleranceProfile
- **Description**: Captures printer-specific clearance offsets derived from calibration coupon.
- **Fields**:
  - `printer_id` (string)
  - `material` (enum: `PLA+`, `PETG`, `ASA`, `Nylon`, `Nylon-CF`)
  - `measurements` (list of ToleranceMeasurement)
  - `updated_at` (ISO 8601)
- **Relationships**: Contains many `ToleranceMeasurement` entries.
- **Validation Rules**: Must include at least one measurement at nominal (0.0 mm) offset; `material` enumerated.

### ToleranceMeasurement
- **Description**: Individual recorded fit result for a specific diameter adjustment.
- **Fields**:
  - `offset_mm` (float, precision 0.01)
  - `fit_quality` (enum: `press`, `snug`, `free`)
  - `notes` (string, optional)
- **Relationships**: Belongs to a `ToleranceProfile`.
- **Validation Rules**: `offset_mm` must match values generated by coupon (-0.2, -0.1, 0, +0.1, +0.2).

## State Transitions

- `EnvironmentProfile.status`: implied via `packages.status`; CLI marks profile as **Ready** when all packages installed and uv active.  
- `ScaffoldReport.status`: transitions from `pending` (implicit) → `pass` or `fail` when CLI completes.  
- `ToleranceProfile`: updates when new calibration run occurs; `updated_at` refreshed and `measurements` replaced.

## Data Volume Assumptions

- Profiles stored locally in JSON/YAML within `data/` directory; expected <50 records total in Phase 0.  
- Calibration YAML per printer estimated <5 KB each.
